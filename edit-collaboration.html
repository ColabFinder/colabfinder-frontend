<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Collaboration â€“ ColabFinder</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- shared nav + search -->
  <div id="global-header"></div>

  <h1>Edit Collaboration</h1>

  <form id="edit-form" style="display:none;">
    <label>Title<br><input id="title"></label><br><br>
    <label>Description<br><textarea id="desc"></textarea></label><br><br>
    <label>Type<br><input id="type"></label><br><br>
    <button>Save changes</button>
  </form>

  <p id="msg"></p>

  <!-- scripts -->
  <script type="module" src="./supabaseClient.js"></script>
  <script type="module" src="./header-loader.js"></script>
  <script type="module">
  import { supabase } from './supabaseClient.js';

  const params    = new URLSearchParams(location.search);
  const collabId  = params.get('id');
  const form      = document.getElementById('edit-form');
  const msg       = document.getElementById('msg');
  const titleInp  = document.getElementById('title');
  const descInp   = document.getElementById('desc');
  const typeInp   = document.getElementById('type');

  if (!collabId) {
    msg.textContent = 'Missing collaboration id (?id=)';
    throw new Error('no id');
  }

  /* ---- load current data ---- */
  (async () => {
    const { data, error } = await supabase
      .from('collaborations')
      .select('title,description,type')
      .eq('id', collabId)
      .single();

    if (error || !data) {
      msg.textContent = 'Collaboration not found.';
      return;
    }
    titleInp.value = data.title;
    descInp.value  = data.description;
    typeInp.value  = data.type;
    form.style.display = 'block';
  })();

  /* ---- save ---- */
  form.onsubmit = async e => {
    e.preventDefault();
    const { error } = await supabase
      .from('collaborations')
      .update({
        title: titleInp.value,
        description: descInp.value,
        type: typeInp.value
      })
      .eq('id', collabId);

    if (error) { alert(error.message); return; }
    location.href = 'dashboard.html';
  };
  </script>
</body>
</html>
