<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Profile</title>
  <link rel="stylesheet" href="styles.css">
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://eqpmbcbaqgdmrhwmvlya.supabase.co';
    const supabaseKey = 'YOUR_PUBLIC_ANON_KEY'; // Replace with your actual Supabase key
    const supabase = createClient(supabaseUrl, supabaseKey);

    window.supabase = supabase; // Make it globally available

    // Check user session
    async function checkUser() {
      const { data: { session }, error } = await supabase.auth.getSession();
      if (error || !session) {
        console.error('âŒ No session found or error occurred:', error);
        window.location.href = '/login.html';
        return;
      }
      console.log('âœ… Session found:', session);
    }

    // Fetch and display the profile
    async function fetchProfile() {
      const {
        data: { user }
      } = await supabase.auth.getUser();

      if (!user) {
        console.error('âŒ No user found');
        return;
      }

      const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      if (error) {
        console.error('âŒ Error fetching profile:', error.message);
        return;
      }

      // Display the profile data
      document.getElementById('creator-type').textContent = data.creator_type || 'Loading...';
      document.getElementById('youtube-followers').textContent = data.youtube_followers || 'Loading...';
      document.getElementById('tiktok-followers').textContent = data.tiktok_followers || 'Loading...';
      document.getElementById('instagram-followers').textContent = data.instagram_followers || 'Loading...';
      document.getElementById('onlyfans-subscribers').textContent = data.onlyfans_subscribers || 'Loading...';
      document.getElementById('niches').textContent = data.niches || 'Loading...';
      document.getElementById('short-bio').textContent = data.short_bio || 'Loading...';
      document.getElementById('preferred-collabs').textContent = data.preferred_collabs || 'Loading...';
    }

    // On page load, check user and fetch the profile
    document.addEventListener('DOMContentLoaded', async () => {
      await checkUser();
      await fetchProfile();
    });
  </script>
</head>
<body>
  <div id="profile-container">
    <h1>ðŸ‘¤ Your Profile</h1>
    <p><strong>Creator Type:</strong> <span id="creator-type">Loading...</span></p>
    <p><strong>YouTube Followers:</strong> <span id="youtube-followers">Loading...</span></p>
    <p><strong>TikTok Followers:</strong> <span id="tiktok-followers">Loading...</span></p>
    <p><strong>Instagram Followers:</strong> <span id="instagram-followers">Loading...</span></p>
    <p><strong>OnlyFans Subscribers:</strong> <span id="onlyfans-subscribers">Loading...</span></p>
    <p><strong>Niches:</strong> <span id="niches">Loading...</span></p>
    <p><strong>Short Bio:</strong> <span id="short-bio">Loading...</span></p>
    <p><strong>Preferred Collabs:</strong> <span id="preferred-collabs">Loading...</span></p>
  </div>
</body>
</html>
